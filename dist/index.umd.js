var ft=Object.defineProperty,mt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var V=(g,o,E)=>o in g?ft(g,o,{enumerable:!0,configurable:!0,writable:!0,value:E}):g[o]=E,k=(g,o)=>{for(var E in o||(o={}))yt.call(o,E)&&V(g,E,o[E]);if(R)for(var E of R(o))Pt.call(o,E)&&V(g,E,o[E]);return g},G=(g,o)=>mt(g,gt(o));(function(g,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(g=typeof globalThis!="undefined"?globalThis:g||self,o(g.VueNestable={},g.Vue))})(this,function(g,o){"use strict";const E={};var I={methods:{registerNestable(t){const e=this._getByGroup(t.group);e.onDragStartListeners.push(t.onDragStart),e.onMouseEnterListeners.push(t.onMouseEnter),e.onMouseMoveListeners.push(t.onMouseMove)},notifyDragStart(t,e,r){const u=this._getByGroup(t);for(const i of u.onDragStartListeners)i(e,r)},notifyMouseEnter(t,e,r,u){const i=this._getByGroup(t);for(const l of i.onMouseEnterListeners)l(e,r,u)},notifyMouseMove(t,e){const r=this._getByGroup(t);for(const u of r.onMouseMoveListeners)u(e)},_getByGroup(t){return E[t]||(E[t]={onDragStartListeners:[],onMouseEnterListeners:[],onMouseMoveListeners:[],onDragStart:[],dragItem:null}),E[t]}}},C=(t,e)=>{const r=t.__vccOpts||t;for(const[u,i]of e)r[u]=i;return r};const O={name:"NestableItem",mixins:[I],props:{item:{type:Object,required:!0,default:()=>({})},index:{type:Number,required:!1,default:null},isChild:{type:Boolean,required:!1,default:!1},isCopy:{type:Boolean,required:!1,default:!1},options:{type:Object,required:!0,default:()=>({})}},inject:["listId","group","keyProp"],data(){return{breakPoint:null,moveDown:!1}},computed:{isDragging(){const t=this.options.dragItem;return!this.isCopy&&t&&t[this.options.keyProp]===this.item[this.options.keyProp]},hasChildren(){return this.item[this.options.childrenProp]&&this.item[this.options.childrenProp].length>0},hasHandle(){return!!this.$scopedSlots.handler},normalizedClassProp(){const t=this.item[this.options.classProp];return t?Array.isArray(t)?t:typeof a=="object"?[t]:[t]:[]},itemClasses(){const t=this.isDragging?["is-dragging"]:[];let e=[`nestable-item${this.isCopy?"-copy":""}`,`nestable-item${this.isCopy?"-copy":""}-${this.item[this.options.keyProp]}`,...t,...this.normalizedClassProp];return this.options.expandable&&e.push(this.item.expanded?"is-active":null),e}},methods:{onMouseEnter(t){if(!!this.options.dragItem){if(!t.movementY)return this.sendNotification(t);this.moveDown=t.movementY>0,this.breakPoint=t.target.getBoundingClientRect().height/2}},onMouseLeave(){this.breakPoint=null},onMouseMove(t){if(!this.breakPoint)return;const e=t.offsetY-this.breakPoint;this.moveDown&&e<this.breakPoint/4||!this.moveDown&&e>-this.breakPoint/4||this.sendNotification(t)},sendNotification(t){this.breakPoint=null;const e=this.item||this.$parent.item;this.notifyMouseEnter(this.group,t,this.listId,e)}}},Y={key:0,class:"nestable-list"};function z(t,e,r,u,i,l){const h=o.resolveComponent("NestableItem",!0);return o.openBlock(),o.createElementBlock("li",{class:o.normalizeClass(l.itemClasses)},[o.createElementVNode("div",{class:"nestable-item-content",onMouseenter:e[0]||(e[0]=(...f)=>l.onMouseEnter&&l.onMouseEnter(...f)),onMouseleave:e[1]||(e[1]=(...f)=>l.onMouseLeave&&l.onMouseLeave(...f)),onMousemove:e[2]||(e[2]=(...f)=>l.onMouseMove&&l.onMouseMove(...f))},[o.renderSlot(t.$slots,"default",{index:r.index,item:r.item,isChild:r.isChild})],32),l.hasChildren?(o.openBlock(),o.createElementBlock("ol",Y,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(r.item[r.options.childrenProp],(f,p)=>(o.openBlock(),o.createBlock(h,{key:f[l.keyProp],item:f,index:p,options:r.options,"is-copy":r.isCopy,"is-child":""},{default:o.withCtx(y=>[o.renderSlot(t.$slots,"default",o.normalizeProps(o.guardReactiveProps(y)))]),_:2},1032,["item","index","options","is-copy"]))),128))])):o.createCommentVNode("",!0)],2)}var H=C(O,[["render",z]]);const X={name:"Placeholder",mixins:[I],props:{index:{type:Number,required:!1,default:null},options:{type:Object,required:!1,default:()=>({})}},inject:["listId","group"],computed:{isDragging(){return this.options.dragItem}},methods:{onMouseEnter(t){!this.options.dragItem||this.notifyMouseEnter(this.group,t,this.listId,null)}}};function F(t,e,r,u,i,l){return o.openBlock(),o.createElementBlock("li",null,[o.createElementVNode("div",{class:"nestable-list-empty",onMouseenter:e[0]||(e[0]=(...h)=>l.onMouseEnter&&l.onMouseEnter(...h))},[o.renderSlot(t.$slots,"default")],32)])}var W=C(X,[["render",F]]),K={methods:{getPathById(t,e=this.value){let r=[];return e.every((u,i)=>{if(u[this.keyProp]===t)r.push(i);else if(u[this.childrenProp]){const l=this.getPathById(t,u[this.childrenProp]);l.length&&(r=r.concat(i).concat(l))}return r.length===0}),r},getItemByPath(t,e=this.value){let r=null;return t.forEach(u=>{r=(r&&r[this.childrenProp]?r[this.childrenProp]:e)[u]}),r},getItemDepth(t){let e=1;if(t[this.childrenProp]&&t[this.childrenProp].length>0){const r=t[this.childrenProp].map(this.getItemDepth);e+=Math.max(...r)}return e},getSplicePath(t,e={}){const r={},u=e.numToRemove||0,i=e.itemsToInsert||[],l=t.length-1;let h=r;return t.forEach((f,p)=>{if(p===l)h.$splice=[[f,u,...i]];else{const y={};h[f]={[e.childrenProp]:y},h=y}}),r},getRealNextPath(t,e){const r=t.length-1,u=e.length-1;if(t.length<e.length){let i=!1;return e.map((l,h)=>i?h===u?l+1:l:typeof t[h]!="number"?l:e[h]>t[h]&&h===r?(i=!0,l-1):l)}else if(t.length===e.length&&e[u]>t[u]){const i=this.getItemByPath(e);if(i[this.childrenProp]&&i[this.childrenProp].length&&!this.isCollapsed(i))return e.slice(0,-1).concat(e[u]-1).concat(0)}return e}}},U={methods:{hook(t,e){if(!this.hooks[t])return!0;const r=this.hooks[t](e);return r||r===void 0}}};function J(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var b={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function r(n){return typeof n=="object"&&!("toString"in n)?Object.prototype.toString.call(n).slice(8,-1):n}var u=typeof process=="object"&&!0;function i(n,s){if(!n)throw u?new Error("Invariant failed"):new Error(s())}e.invariant=i;var l=Object.prototype.hasOwnProperty,h=Array.prototype.splice,f=Object.prototype.toString;function p(n){return f.call(n).slice(8,-1)}var y=Object.assign||function(n,s){return v(s).forEach(function(d){l.call(s,d)&&(n[d]=s[d])}),n},v=typeof Object.getOwnPropertySymbols=="function"?function(n){return Object.keys(n).concat(Object.getOwnPropertySymbols(n))}:function(n){return Object.keys(n)};function D(n){return Array.isArray(n)?y(n.constructor(n.length),n):p(n)==="Map"?new Map(n):p(n)==="Set"?new Set(n):n&&typeof n=="object"?y(Object.create(Object.getPrototypeOf(n)),n):n}var q=function(){function n(){this.commands=y({},at),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(s,d){return s===d},this.update.newContext=function(){return new n().update}}return Object.defineProperty(n.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(s){this.update.isEquals=s},enumerable:!0,configurable:!0}),n.prototype.extend=function(s,d){this.commands[s]=d},n.prototype.update=function(s,d){var m=this,c=typeof d=="function"?{$apply:d}:d;Array.isArray(s)&&Array.isArray(c)||i(!Array.isArray(c),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),i(typeof c=="object"&&c!==null,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the "+("following commands: "+Object.keys(m.commands).join(", ")+".")});var P=s;return v(c).forEach(function(M){if(l.call(m.commands,M)){var pt=s===P;P=m.commands[M](c[M],P,c,s),pt&&m.isEquals(P,s)&&(P=s)}else{var B=p(s)==="Map"?m.update(s.get(M),c[M]):m.update(s[M],c[M]),ct=p(P)==="Map"?P.get(M):P[M];(!m.isEquals(B,ct)||typeof B=="undefined"&&!l.call(s,M))&&(P===s&&(P=D(s)),p(P)==="Map"?P.set(M,B):P[M]=B)}}),P},n}();e.Context=q;var at={$push:function(n,s,d){return L(s,d,"$push"),n.length?s.concat(n):s},$unshift:function(n,s,d){return L(s,d,"$unshift"),n.length?n.concat(s):s},$splice:function(n,s,d,m){return lt(s,d),n.forEach(function(c){A(c),s===m&&c.length&&(s=D(m)),h.apply(s,c)}),s},$set:function(n,s,d){return ht(d),n},$toggle:function(n,s){S(n,"$toggle");var d=n.length?D(s):s;return n.forEach(function(m){d[m]=!s[m]}),d},$unset:function(n,s,d,m){return S(n,"$unset"),n.forEach(function(c){Object.hasOwnProperty.call(s,c)&&(s===m&&(s=D(m)),delete s[c])}),s},$add:function(n,s,d,m){return x(s,"$add"),S(n,"$add"),p(s)==="Map"?n.forEach(function(c){var P=c[0],M=c[1];s===m&&s.get(P)!==M&&(s=D(m)),s.set(P,M)}):n.forEach(function(c){s===m&&!s.has(c)&&(s=D(m)),s.add(c)}),s},$remove:function(n,s,d,m){return x(s,"$remove"),S(n,"$remove"),n.forEach(function(c){s===m&&s.has(c)&&(s=D(m)),s.delete(c)}),s},$merge:function(n,s,d,m){return dt(s,n),v(n).forEach(function(c){n[c]!==s[c]&&(s===m&&(s=D(m)),s[c]=n[c])}),s},$apply:function(n,s){return ut(n),n(s)}},w=new q;e.isEquals=w.update.isEquals,e.extend=w.extend,e.default=w.update,e.default.default=t.exports=y(e.default,e);function L(n,s,d){i(Array.isArray(n),function(){return"update(): expected target of "+r(d)+" to be an array; got "+r(n)+"."}),S(s[d],d)}function S(n,s){i(Array.isArray(n),function(){return"update(): expected spec of "+r(s)+" to be an array; got "+r(n)+". Did you forget to wrap your parameter in an array?"})}function lt(n,s){i(Array.isArray(n),function(){return"Expected $splice target to be an array; got "+r(n)}),A(s.$splice)}function A(n){i(Array.isArray(n),function(){return"update(): expected spec of $splice to be an array of arrays; got "+r(n)+". Did you forget to wrap your parameters in an array?"})}function ut(n){i(typeof n=="function",function(){return"update(): expected spec of $apply to be a function; got "+r(n)+"."})}function ht(n){i(Object.keys(n).length===1,function(){return"Cannot have more than one key in an object with $set"})}function dt(n,s){i(s&&typeof s=="object",function(){return"update(): $merge expects a spec of type 'object'; got "+r(s)}),i(n&&typeof n=="object",function(){return"update(): $merge expects a target of type 'object'; got "+r(n)})}function x(n,s){var d=p(n);i(d==="Map"||d==="Set",function(){return"update(): "+r(s)+" expects a target of type Set or Map; got "+r(d)})}})(b,b.exports);var T=J(b.exports);const Q=(t,e)=>t.closest(e),Z=t=>{var e=t.getBoundingClientRect();return{top:Math.round(e.top),left:Math.round(e.left)}},j=(t,e)=>({transform:"translate("+t+"px, "+e+"px)"}),N=(t,e)=>t.map(r=>G(k({},r),{[e]:r[e]?N(r[e],e):[]})),tt={name:"VueNestable",components:{NestableItem:H,Placeholder:W},mixins:[K,I,U],props:{value:{type:Array,required:!0,default:()=>[]},threshold:{type:Number,required:!1,default:30},maxDepth:{type:Number,required:!1,default:10},keyProp:{type:String,required:!1,default:"id"},classProp:{type:String,required:!1,default:null},group:{type:[String,Number],required:!1,default:()=>Math.random().toString(36).slice(2)},childrenProp:{type:String,required:!1,default:"children"},collapsed:{type:Boolean,required:!1,default:!1},hooks:{type:Object,required:!1,default:()=>({})},rtl:{type:Boolean,required:!1,default:!1},expandable:{type:Boolean,required:!1,default:!1}},provide(){return{listId:this.listId,group:this.group,keyProp:this.keyProp,onDragEnd:this.onDragEnd}},data(){return{itemsOld:null,dragItem:null,mouse:{last:{x:0},shift:{x:0}},el:null,elCopyStyles:null,isDirty:!1,collapsedGroups:[],listId:Math.random().toString(36).slice(2)}},computed:{listIsEmpty(){return this.value.length===0},itemOptions(){return{dragItem:this.dragItem,keyProp:this.keyProp,classProp:this.classProp,childrenProp:this.childrenProp,expandable:this.expandable}},listStyles(){const t=document.querySelector(".nestable-"+this.group+" .nestable-item-"+this.dragItem[this.keyProp]);let e={};return t&&(e.width=`${t.clientWidth}px`),this.elCopyStyles&&(e=k(k({},e),this.elCopyStyles)),e}},created(){const t=N(this.value,this.childrenProp);this.$emit("input",t),this.isDirty=!1,this.registerNestable(this)},beforeDestroy(){this.stopTrackMouse()},methods:{startTrackMouse(){document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onDragEnd),document.addEventListener("touchend",this.onDragEnd),document.addEventListener("touchcancel",this.onDragEnd),document.addEventListener("keydown",this.onKeyDown)},stopTrackMouse(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onDragEnd),document.removeEventListener("touchend",this.onDragEnd),document.removeEventListener("touchcancel",this.onDragEnd),document.removeEventListener("keydown",this.onKeyDown),this.elCopyStyles=null},onDragStart(t,e){t&&(t.preventDefault(),t.stopPropagation()),this.el=Q(t.target,".nestable-item"),this.startTrackMouse(),this.dragItem=e,this.itemsOld=this.value,this.$nextTick(()=>{this.onMouseMove(t)})},onDragEnd(t,e){t&&t.preventDefault(),this.stopTrackMouse(),this.el=null,e?this.dragRevert():this.dragApply()},onKeyDown(t){t.which===27&&this.onDragEnd(null,!0)},getXandYFromEvent(t){let{clientX:e,clientY:r}=t;const{targetTouches:u}=t;if(u){const i=u[0];e=i.clientX,r=i.clientY;const l=new Event("mouseenter"),h=document.elementFromPoint(e,r),f=h&&(h.closest(".nestable-item-content")||h.closest(".nestable-list-empty"));f&&f.dispatchEvent(l)}return{clientX:e,clientY:r}},onMouseMove(t){t&&t.preventDefault();const{clientX:e,clientY:r}=this.getXandYFromEvent(t);this.mouse.last.x===0&&(this.mouse.last.x=e);const u=j(e,r),i=document.querySelector(".nestable-"+this.group+" .nestable-drag-layer");if(!i)return;const{top:l,left:h}=i.getBoundingClientRect(),f=document.querySelector(".nestable-"+this.group+" .nestable-drag-layer > .nestable-list");if(this.elCopyStyles){if(this.elCopyStyles=k(k({},this.elCopyStyles),u),f)for(const y in u)Object.prototype.hasOwnProperty.call(u,y)&&(f.style[y]=u[y]);const p=this.rtl?this.mouse.last.x-e:e-this.mouse.last.x;p>=0&&this.mouse.shift.x>=0||p<=0&&this.mouse.shift.x<=0?this.mouse.shift.x+=p:this.mouse.shift.x=0,this.mouse.last.x=e,Math.abs(this.mouse.shift.x)>this.threshold&&(this.mouse.shift.x>0?this.tryIncreaseDepth(this.dragItem):this.tryDecreaseDepth(this.dragItem),this.mouse.shift.x=0)}else{const p=Z(this.el);this.elCopyStyles=k({marginTop:`${p.top-r-l}px`,marginLeft:`${p.left-e-h}px`},u)}},moveItem({dragItem:t,pathFrom:e,pathTo:r}){const u=this.getRealNextPath(e,r),i=this.getSplicePath(e,{numToRemove:1,childrenProp:this.childrenProp}),l=this.getSplicePath(u,{numToRemove:0,itemsToInsert:[t],childrenProp:this.childrenProp});if(this.expandable){const f=t.expanded;let p=u;p.pop(),this.lastTouchedPath=p;let y=this.getItemByPath(p);y&&(y.expanded=!0),!f&&t.expanded&&(t.expanded=!1)}if(!this.hook("beforeMove",{dragItem:t,pathFrom:e,pathTo:u}))return;let h=this.value;h=T(h,i),h=T(h,l),this.isDirty=!0,this.pathTo=u,this.$emit("input",h)},tryIncreaseDepth(t){const e=this.getPathById(t[this.keyProp]),r=e[e.length-1],u=e.length+this.getItemDepth(t);if(r>0&&u<=this.maxDepth){const i=this.getItemByPath(e.slice(0,-1).concat(r-1));if(i[this.childrenProp]&&(!i[this.childrenProp].length||!this.isCollapsed(i))){const l=e.slice(0,-1).concat(r-1).concat(i[this.childrenProp].length);this.moveItem({dragItem:t,pathFrom:e,pathTo:l})}}},tryDecreaseDepth(t){const e=this.getPathById(t[this.keyProp]),r=e[e.length-1];if(e.length>1){const u=this.getItemByPath(e.slice(0,-1));if(r+1===u[this.childrenProp].length){const i=e.slice(0,-1);i[i.length-1]+=1,this.moveItem({dragItem:t,pathFrom:e,pathTo:i})}}},onMouseEnter(t,e,r){t&&(t.preventDefault(),t.stopPropagation());const u=this.dragItem;if(!u||r!==null&&u[this.keyProp]===r[this.keyProp])return;const i=this.getPathById(u[this.keyProp]);if(e!==this.listId&&i.length===0)return;let l;if(r===null?l=i.length>0?[]:[0]:l=this.getPathById(r[this.keyProp]),this.getRealNextPath(i,l).length+(this.getItemDepth(u)-1)>this.maxDepth)return;let f={};if(this.collapsed&&i.length>1){const p=this.getItemByPath(i.slice(0,-1));p[this.childrenProp].length===1&&(f=this.onToggleCollapse(p,!0))}this.moveItem({dragItem:u,pathFrom:i,pathTo:l},f)},isCollapsed(t){return!!(this.collapsedGroups.indexOf(t[this.keyProp])>-1^this.collapsed)},dragApply(){this.$emit("change",this.dragItem,{items:this.value,pathTo:this.pathTo}),this.pathTo=null,this.itemsOld=null,this.dragItem=null,this.isDirty=!1},dragRevert(){this.$emit("input",this.itemsOld),this.pathTo=null,this.itemsOld=null,this.dragItem=null,this.isDirty=!1}}},et=o.createTextVNode(" No content "),nt={key:0,class:"nestable-drag-layer"};function st(t,e,r,u,i,l){const h=o.resolveComponent("Placeholder"),f=o.resolveComponent("NestableItem");return o.openBlock(),o.createElementBlock("div",{class:o.normalizeClass(["nestable",`nestable-${r.group}`,r.rtl?"nestable-rtl":""])},[o.createElementVNode("ol",{class:o.normalizeClass(["nestable-list nestable-group",{expandable:r.expandable}])},[l.listIsEmpty?(o.openBlock(),o.createBlock(h,{key:0,options:l.itemOptions},{default:o.withCtx(()=>[o.renderSlot(t.$slots,"placeholder",{},()=>[et])]),_:3},8,["options"])):o.createCommentVNode("",!0),(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(r.value,(p,y)=>(o.openBlock(),o.createBlock(f,{key:p[r.keyProp],index:y,item:p,options:l.itemOptions},{default:o.withCtx(v=>[o.renderSlot(t.$slots,"default",o.normalizeProps(o.guardReactiveProps(v)))]),_:2},1032,["index","item","options"]))),128))],2),i.dragItem?(o.openBlock(),o.createElementBlock("div",nt,[o.createElementVNode("ol",{style:o.normalizeStyle(l.listStyles),class:"nestable-list"},[o.createVNode(f,{item:i.dragItem,options:l.itemOptions,"is-copy":!0},{default:o.withCtx(p=>[o.renderSlot(t.$slots,"default",o.normalizeProps(o.guardReactiveProps(p)))]),_:3},8,["item","options"])],4)])):o.createCommentVNode("",!0)],2)}var _=C(tt,[["render",st]]);const rt={name:"VueNestableHandle",mixins:[I],props:{item:{type:Object,required:!1,default:()=>({})}},inject:["group","onDragEnd"],methods:{isEmpty(t){if(t==null)return!0;if(t.length>0)return!1;if(t.length===0)return!0;for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},dragstart(t){const e=this.isEmpty(this.item)?this.$parent.item:this.item;this.notifyDragStart(this.group,t,e)},touchend(t){console.log(t),this.onDragEnd(t)},touchmove(t){console.log(t),this.notifyMouseMove(this.group,t)}}};function ot(t,e,r,u,i,l){return o.openBlock(),o.createElementBlock("div",{draggable:"true",class:"nestable-handle",onDragstart:e[0]||(e[0]=(...h)=>l.dragstart&&l.dragstart(...h)),onTouchstart:e[1]||(e[1]=(...h)=>l.dragstart&&l.dragstart(...h)),onTouchend:e[2]||(e[2]=(...h)=>l.touchend&&l.touchend(...h)),onTouchmove:e[3]||(e[3]=(...h)=>l.touchmove&&l.touchmove(...h))},[o.renderSlot(t.$slots,"default")],32)}var $=C(rt,[["render",ot]]),it={install:function(t){t.component("VueNestable",_),t.component("VueNestableHandle",$)}};g.VueNestable=_,g.VueNestableHandle=$,g.default=it,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
